@using MyGameShelf.Web.ViewModels
@model ProfileViewModel

@{
    ViewData["Title"] = $"{Model.Username ?? "User"}'s Profile";

    // Check if user viewing profile is Authenticated and if user is profile owner
    bool isOwner = User.Identity.IsAuthenticated && User.Identity.Name == Model.Username;

    // Check Last Active Status within the hour
    var lastActive = Model.LastActive;
    var now = DateTime.Now;
    var isWithinLastHour = (now - lastActive).TotalMinutes <= 60;
}

<div class="row">
    <div class="col-11 col-md-10">        
        <h4 class="text-center text-md-start mx-md-2">
            <i class="fa-solid fa-user"></i>
            <span class="ms-2">@Model.Username Profile</span>
        </h4>
    </div>
    <div class="col-1 col-md-2">
        @if (isOwner)
        {
            <a class="nav-link" asp-area="" asp-controller="Profile" asp-action="Settings" data-bs-toggle="tooltip" title="Go to account settings">
                <i class="fa-solid fa-gear"></i>
                <span class="ms-2 d-none d-md-inline">Account Settings</span>
            </a>
        }
    </div>
</div>

<div class="container mt-2 px-0">
    <div class="row">
        <!-- Left Sidebar (Profile Details) -->
        <div class="col-md-3 d-flex flex-column gap-3">
            <!-- Profile Picture -->
            <div class="text-center" style="width: 100%; height: 100%;">
                <img src="@Model.ProfilePictureUrl" alt="@Model.Username" class="img-fluid rounded img-thumbnail" style="width: 100%; height: auto; max-width: 300px; object-fit: cover;">
            </div>

            <!-- Profile Info -->
            <div class="bg-light text-dark rounded p-2">
                @if (isOwner || (!isOwner && Model.IsPublic))
                {
                    <h4 class="text-center text-md-start col-12 mb-3 ">@($"{Model.FirstName} {Model.LastName}")</h4>

                    <dl class="row px-4 px-md-0">
                        <dt class="col-5 responsive-font">Last Online</dt>
                        <dd class="col-7 responsive-font">@(isWithinLastHour ? "Now" : lastActive.ToString("MMM dd, yyyy"))</dd>

                        <dt class="col-5 responsive-font">Gender</dt>
                        <dd class="col-7 responsive-font">@Model.Gender</dd>

                        <dt class="col-5 responsive-font">Birthday</dt>
                        <dd class="col-7 responsive-font">@Model.Birthday.ToString("MMM dd, yyyy")</dd>

                        <dt class="col-5 responsive-font">Location</dt>
                        <dd class="col-7 responsive-font">@($"{Model.Address.City}, {Model.Address.Country}")</dd>

                        <dt class="col-5 responsive-font">Joined</dt>
                        <dd class="col-7 responsive-font">@Model.CreatedAt.ToString("MMM dd, yyyy")</dd>
                    </dl>

                    <hr class="my-3"/>

                    <!-- Social Links -->
                    <div class="d-flex justify-content-around align-items-center my-0 py-0">
                        @if (!string.IsNullOrWhiteSpace(Model.XSocialLink))
                        {
                            <a href="@Model.XSocialLink" target="_blank" rel="noopener" aria-label="Twitter">
                                <i class="fab fa-twitter social-icon"></i>
                            </a>
                        }

                        @if (!string.IsNullOrWhiteSpace(Model.InstagramSocialLink))
                        {
                            <a href="@Model.InstagramSocialLink" target="_blank" rel="noopener" aria-label="Instagram">
                                <i class="fab fa-instagram social-icon"></i>
                            </a>
                        }

                        @if (!string.IsNullOrWhiteSpace(Model.FacebookSocialLink))
                        {
                            <a href="@Model.FacebookSocialLink" target="_blank" rel="noopener" aria-label="Facebook">
                                <i class="fab fa-facebook social-icon"></i>
                            </a>
                        }

                        @if (!string.IsNullOrWhiteSpace(Model.YoutubeSocialLink))
                        {
                            <a href="@Model.YoutubeSocialLink" target="_blank" rel="noopener" aria-label="YouTube">
                                <i class="fab fa-youtube social-icon"></i>
                            </a>
                        }

                        @if (!string.IsNullOrWhiteSpace(Model.TwitchSocialLink))
                        {
                            <a href="@Model.TwitchSocialLink" target="_blank" rel="noopener" aria-label="Twitch">
                                <i class="fab fa-twitch social-icon"></i>
                            </a>
                        }
                    </div>
                }

            </div>

            <hr class="my-1"/>

            <!-- Profile Stats -->
            <div class="bg-light text-dark rounded p-2">
                @if (isOwner || (!isOwner && Model.IsPublic))
                {
                    <h4 class="text-center text-md-start col-12 mb-3 ">Statistics</h4>
                    <dl class="row px-4 px-md-0">
                        <dt class="col-8 responsive-font">Games Tracked</dt>
                        <dd class="col-4 responsive-font">42</dd>

                        <dt class="col-8 responsive-font">Completed</dt>
                        <dd class="col-4 responsive-font">28</dd>

                        <dt class="col-8 responsive-font">Playing</dt>
                        <dd class="col-4 responsive-font">4</dd>

                        <dt class="col-8 responsive-font">On Hold</dt>
                        <dd class="col-4 responsive-font">8</dd>

                        <dt class="col-8 responsive-font">Dropped</dt>
                        <dd class="col-4 responsive-font">2</dd>

                        <dt class="col-8 responsive-font">Planned</dt>
                        <dd class="col-4 responsive-font">15</dd>

                        <dt class="col-8 responsive-font">Want</dt>
                        <dd class="col-4 responsive-font">31</dd>

                        <dt class="col-8 responsive-font">Reviews</dt>
                        <dd class="col-4 responsive-font">15</dd>

                        <dt class="col-8 responsive-font">Followers</dt>
                        <dd class="col-4 responsive-font">48</dd>

                        <dt class="col-8 responsive-font">Following</dt>
                        <dd class="col-4 responsive-font">120</dd>
                    </dl>
                }
            </div>


        </div>

        <!-- Right Main Content -->
        <div class="col-md-9 d-flex flex-column gap-3">
            @if (isOwner || (!isOwner && Model.IsPublic))
            {
                    <!-- Profile Message -->
                    <div class="p-3 border rounded bg-light text-dark" style="min-height: 120px; max-height: 200px; overflow-y: auto;">
                        @if (Model.IsPublic)
                        {
                            @if (!string.IsNullOrWhiteSpace(Model.ProfileMessage))
                            {
                                <p>@Model.ProfileMessage</p>
                            }
                        }
                    </div>

                    <!-- Game List -->
                    <div>
                        <ul class="nav nav-tabs mb-3 bg-light-subtle rounded" id="profileTab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="games-tab" data-bs-toggle="tab" data-bs-target="#games" type="button" role="tab" aria-controls="games" aria-selected="true">
                                    Game List
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="favorites-tab" data-bs-toggle="tab" data-bs-target="#favorites" type="button" role="tab" aria-controls="favorites" aria-selected="false">
                                    Favorites
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab" aria-controls="reviews" aria-selected="false">
                                    Reviews
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="following-tab" data-bs-toggle="tab" data-bs-target="#following" type="button" role="tab" aria-controls="following" aria-selected="false">
                                    Following
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="followers-tab" data-bs-toggle="tab" data-bs-target="#followers" type="button" role="tab" aria-controls="followers" aria-selected="false">
                                    Followers
                                </button>
                            </li>
                        </ul>

                        <div class="tab-content" id="profileTabContent">
                            <!-- Game List Tab -->
                            <div class="tab-pane fade show active" id="games" role="tabpanel" aria-labelledby="games-tab">
                                <div class="card mb-2">
                                    <div class="card-body">
                                        <strong>The Witcher 3</strong> <span class="text-muted">(Completed)</span>
                                    </div>
                                </div>
                                <div class="card mb-2">
                                    <div class="card-body">
                                        <strong>Hades</strong> <span class="text-muted">(Playing)</span>
                                    </div>
                                </div>
                                <div class="card mb-2">
                                    <div class="card-body">
                                        <strong>Stardew Valley</strong> <span class="text-muted">(Backlog)</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Favorites Tab -->
                            <div class="tab-pane fade" id="favorites" role="tabpanel" aria-labelledby="favorites-tab">
                                <p>No favorites yet.</p>
                            </div>

                            <!-- Reviews Tab -->
                            <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                                <p>No reviews written yet.</p>
                            </div>

                            <!-- Following Tab -->
                            <div class="tab-pane fade" id="following" role="tabpanel" aria-labelledby="following-tab">
                                <p>Not following anyone yet.</p>
                            </div>

                            <!-- Followers Tab -->
                            <div class="tab-pane fade" id="followers" role="tabpanel" aria-labelledby="followers-tab">
                                <p>No followers yet.</p>
                            </div>
                        </div>


                    </div>
            }
            else if (!isOwner && !Model.IsPublic)
            {
                <div>
                    <i class="fa-solid fa-lock"></i> This profile is private.
                </div>
            }
        </div>

    </div>
</div>
